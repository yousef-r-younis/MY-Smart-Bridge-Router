#!/bin/sh
echo "Content-type: application/json"
echo ""

# Find correct queue index for 'phy1-ap1'
INDEX=$(uci show sqm | grep "interface='phy1-ap1'" | cut -d'[' -f2 | cut -d']' -f1)

if [ -n "$INDEX" ]; then
    DOWNLOAD=$(uci get sqm.@queue[$INDEX].download)
    UPLOAD=$(uci get sqm.@queue[$INDEX].upload)
    ENABLED=$(uci get sqm.@queue[$INDEX].enabled)

    echo "{\"download\": \"$DOWNLOAD\", \"upload\": \"$UPLOAD\", \"enabled\": \"$ENABLED\"}"
else
    echo "{\"status\": \"error\", \"message\": \"Guest SQM profile not found\"}"
fi