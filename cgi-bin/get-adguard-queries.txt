#!/bin/sh
echo "Content-type: text/plain"
echo ""

# Define API endpoints and credentials
QUERYLOG_URL="http://70.70.70.1:8080/control/querylog"
USERNAME="Senior_adBlock"
PASSWORD="adblock700800900"

# Fetch recent queries (last 100)
echo "--- recent_queries ---"
QUERYLOG=$(curl -s -u "$USERNAME:$PASSWORD" "$QUERYLOG_URL?limit=100")

# Extract and display each query in a simple format
echo "$QUERYLOG" | grep -o '"question":{[^}]*}' | while read -r QUESTION; do
    DOMAIN=$(echo "$QUESTION" | grep -o '"name":"[^"]*' | cut -d'"' -f4)
    TYPE=$(echo "$QUESTION" | grep -o '"type":"[^"]*' | cut -d'"' -f4)
    echo "$DOMAIN ($TYPE)"
done